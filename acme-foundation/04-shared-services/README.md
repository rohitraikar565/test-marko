# 04-shared-services
This root module creates shared environment. Shared environment can be used to host shared services such as:
1. central DNS
2. Secrets Manager
3. Vault
4. etc.

By default, this module will create one project with a VPC and private DNS zones for resective environments.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:-----:|
| billing\_account\_id | Billing Account ID | `any` | n/a | yes |
| org\_id | Organization ID | `any` | n/a | yes |
| private\_dns | Map of private DNS zones to create. Key is the name of the zone | <pre>map(object({<br>    domain  = string // Must end with a dot. e.g. dev.example.com.<br>    project = string // Project Name specified in var.projects<br>    vpc     = string // VPC Name specified in var.projects<br>    recordsets = optional(list(object({<br>      name    = string<br>      type    = string<br>      ttl     = number<br>      records = list(string)<br>    })), [])<br>  }))<br></pre> | n/a | yes |
| projects | Map of projects to create. Key is the name of the project | <pre>map(object({<br>    labels                         = optional(map(string), {})<br>    enable_shared_vpc_host_project = optional(bool, false)<br>    activate_apis = optional(list(string), [<br>      "compute.googleapis.com",<br>      "container.googleapis.com",<br>      "dataproc.googleapis.com",<br>      "dataflow.googleapis.com",<br>      "composer.googleapis.com",<br>      "vpcaccess.googleapis.com",<br>      "dns.googleapis.com",<br>    ])<br>    vpcs = map(object({<br>      subnets                                = list(map(string))<br>      routing_mode                           = optional(string, "GLOBAL")<br>      secondary_ranges                       = optional(map(list(object({ range_name = string, ip_cidr_range = string }))), {})<br>      routes                                 = optional(list(map(string)), [])<br>      delete_default_internet_gateway_routes = optional(bool, false)<br>      mtu                                    = optional(number, 0)<br>      firewall_enable_logging                = optional(bool, false)<br><br>      # Type: list(object), with fields:<br>      # - name (string, required): Name of the NAT.<br>      # - nat_ip_allocate_option (string, optional): How external IPs should be allocated for this NAT. Defaults to MANUAL_ONLY if nat_ips are set, else AUTO_ONLY.<br>      # - source_subnetwork_ip_ranges_to_nat (string, optional): How NAT should be configured per Subnetwork. Defaults to ALL_SUBNETWORKS_ALL_IP_RANGES.<br>      # - nat_ips (list(number), optional): Self-links of NAT IPs.<br>      # - min_ports_per_vm (number, optional): Minimum number of ports allocated to a VM from this NAT.<br>      # - max_ports_per_vm (number, optional): Maximum number of ports allocated to a VM from this NAT. This field can only be set when enableDynamicPortAllocation is enabled.<br>      # - udp_idle_timeout_sec (number, optional): Timeout (in seconds) for UDP connections. Defaults to 30s if not set.<br>      # - icmp_idle_timeout_sec (number, optional): Timeout (in seconds) for ICMP connections. Defaults to 30s if not set.<br>      # - tcp_established_idle_timeout_sec (number, optional): Timeout (in seconds) for TCP established connections. Defaults to 1200s if not set.<br>      # - tcp_transitory_idle_timeout_sec (number, optional): Timeout (in seconds) for TCP transitory connections. Defaults to 30s if not set.<br>      # - log_config (object, optional):<br>      #    - filter: Specifies the desired filtering of logs on this NAT. Defaults to "ALL".<br>      # - subnetworks (list(objects), optional):<br>      #   - name (string, required): subnetwork name to NAT.<br>      #   - source_ip_ranges_to_nat (string, required): List of options for which source IPs in the subnetwork should have NAT enabled.<br>      #   - secondary_ip_range_names (string, optional): List of the secondary ranges of the subnetwork that are allowed to use NAT.<br>      nats = optional(map(object({<br>        region                             = string<br>        nat_ip_allocate_option             = optional(string, "AUTO_ONLY")<br>        source_subnetwork_ip_ranges_to_nat = optional(string, "ALL_SUBNETWORKS_ALL_IP_RANGES")<br>        nat_ips                            = optional(list(string), [])<br>        min_ports_per_vm                   = optional(number, 0)<br>        max_ports_per_vm                   = optional(number, 0)<br>        udp_idle_timeout_sec               = optional(number, 30)<br>        icmp_idle_timeout_sec              = optional(number, 30)<br>        tcp_established_idle_timeout_sec   = optional(number, 1200)<br>        tcp_transitory_idle_timeout_sec    = optional(number, 30)<br>        log_config = optional(object({<br>          enable = optional(bool, false)<br>          filter = optional(string, "ALL")<br>        }), {})<br>        subnetworks = optional(list(object({<br>          name                     = string<br>          source_ip_ranges_to_nat  = list(string)<br>          secondary_ip_range_names = optional(list(string), [])<br>        })), [])<br>      })), {})<br>    }))<br>  }))<br></pre> | n/a | yes |
| terraform\_service\_account | The service account id used by Terraform Cloud to access GCP. This is set in 01-administration/terraform.tfvars | `any` | n/a | yes |
| tfc\_organization | The TFC organization name | `any` | n/a | yes |
| workload\_identity\_pool\_provider\_id | GCP workload identity pool provider ID. Set this value in your workspace after the initial deployement | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| projects | The projects created in the shared folder |
| vpcs | The VPCs created in the shared folder |